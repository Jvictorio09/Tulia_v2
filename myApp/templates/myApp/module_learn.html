{% extends 'myApp/base.html' %}

{% block title %}Module {{ module.code }} · Learn{% endblock %}

{% block header_title %}
<div class="hidden md:flex items-center gap-2 text-sm font-semibold text-[color:var(--text-muted)]">
    <a href="{% url 'home' %}" class="focus-ring">Districts</a>
    <i class="fa-solid fa-angles-right text-[10px]"></i>
    <a href="{% url 'district_overview' module.level.number %}" class="focus-ring">District {{ module.level.number }}</a>
    <i class="fa-solid fa-angles-right text-[10px]"></i>
    <span>Module {{ module.code }}</span>
</div>
{% endblock %}

{% block content %}
<div class="space-y-8">
    <header class="bg-[color:var(--bg-card)] border border-[color:var(--border-default)] rounded-[var(--radius-card)] shadow-soft p-6 sm:p-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="space-y-2">
            <p class="text-xs font-semibold uppercase tracking-[0.24em] text-[color:var(--text-muted)]">Module {{ module.code }}</p>
            <h1 class="text-[28px] font-heading font-bold text-[color:var(--text-primary)] leading-tight tracking-[-0.01em]">{{ module.name }}</h1>
            {% if module.description %}
            <p class="text-sm text-[color:var(--text-secondary)] leading-relaxed max-w-2xl">{{ module.description }}</p>
            {% endif %}
        </div>
        <a href="{% url 'district_overview' module.level.number %}"
           class="inline-flex items-center justify-center gap-2 px-4 py-3 rounded-[8px] border border-[color:var(--border-default)] bg-[color:var(--bg-subtle)] text-sm font-semibold text-[color:var(--text-secondary)] focus-ring">
            <i class="fa-solid fa-arrow-left"></i>
            <span>District Overview</span>
        </a>
    </header>

    <section class="grid gap-6 xl:grid-cols-[2fr_1fr]">
        <div class="space-y-6">
            <div class="bg-[color:var(--bg-card)] border border-[color:var(--border-default)] rounded-[var(--radius-card)] shadow-soft overflow-hidden">
                <div class="aspect-video bg-[color:var(--bg-subtle)] flex items-center justify-center">
                    {% if video_url %}
                    <video controls class="w-full h-full object-cover focus-ring">
                        <source src="{{ video_url }}">
                        Your browser does not support the video tag.
                    </video>
                    {% else %}
                    <div class="p-6 text-center text-[color:var(--text-muted)]">
                        <p class="text-sm font-medium">Lesson video coming soon. Review the transcript and coach guidance below.</p>
                    </div>
                    {% endif %}
                </div>
                {% if module.lesson_duration %}
                <p class="text-xs text-[color:var(--text-muted)] px-4 py-3 border-t border-[color:var(--border-default)]">Duration: {{ module.lesson_duration }} seconds</p>
                {% endif %}
            </div>

            <div class="bg-[color:var(--bg-card)] border border-[color:var(--border-default)] rounded-[var(--radius-card)] shadow-soft p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-[18px] font-heading font-semibold text-[color:var(--text-secondary)] flex items-center gap-2">
                        <i class="fa-solid fa-file-lines text-[color:var(--accent-primary)]"></i>
                        <span>Live Transcript</span>
                    </h2>
                    {% if not transcript %}
                    <span class="chip chip--locked text-xs">Pending</span>
                    {% endif %}
                </div>
                {% if transcript %}
                <div class="space-y-4 text-sm text-[color:var(--text-secondary)] leading-relaxed max-h-[420px] overflow-y-auto pr-2">
                    {% for paragraph in transcript.splitlines %}
                        {% if paragraph %}
                        <p>{{ paragraph }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-[color:var(--text-muted)]">Transcript processing—check back soon. You can still ask the coach about this module.</p>
                {% endif %}
            </div>
        </div>

        <aside class="space-y-6">
            <div class="bg-[color:var(--bg-card)] border border-[color:var(--border-default)] rounded-[var(--radius-card)] shadow-soft p-6">
                <h2 class="text-[18px] font-heading font-semibold text-[color:var(--text-secondary)] flex items-center gap-2 mb-3">
                    <i class="fa-solid fa-robot text-[color:var(--accent-primary)]"></i>
                    <span>AI Coach</span>
                </h2>
                <p class="text-sm text-[color:var(--text-muted)] mb-4">
                    Ask the coach about lesson takeaways, next steps, or how to apply the techniques in your upcoming moments.
                </p>
                <ul class="space-y-2 text-sm text-[color:var(--text-secondary)]">
                    {% for block in knowledge_blocks %}
                    <li class="border border-[color:var(--border-default)] rounded-[8px] px-3 py-2 bg-[color:var(--bg-subtle)]">
                        <span class="font-semibold text-[color:var(--text-secondary)]">{{ block.title }}</span>
                        <p class="text-xs text-[color:var(--text-muted)]">{{ block.summary|truncatewords:20 }}</p>
                    </li>
                    {% empty %}
                    <li class="text-xs text-[color:var(--text-muted)]">Knowledge blocks will appear here once seeded.</li>
                    {% endfor %}
                </ul>
                <a href="{% url 'ai_chat' %}"
                   class="mt-4 inline-flex items-center justify-center gap-2 px-4 py-3 rounded-[8px] bg-[color:var(--accent-primary)] text-white text-sm font-semibold focus-ring animate-press w-full">
                    <i class="fa-solid fa-robot"></i>
                    <span>Chat with Coach</span>
                </a>
            </div>

            <div class="bg-[color:var(--bg-card)] border border-[color:var(--border-default)] rounded-[var(--radius-card)] shadow-soft p-6 space-y-3">
                <h2 class="text-[18px] font-heading font-semibold text-[color:var(--text-secondary)]">Next Steps</h2>
                <p class="text-sm text-[color:var(--text-muted)]">Move into the interactive exercises to lock in the skills and unlock your next venue.</p>
                <a href="{% url 'module_exercises' module.code %}"
                   class="inline-flex items-center justify-center gap-2 px-4 py-3 rounded-[8px] bg-[color:var(--accent-primary)] text-white text-sm font-semibold focus-ring animate-press w-full">
                    <i class="fa-solid fa-play"></i>
                    <span>Continue to Exercises</span>
                </a>
            </div>
        </aside>
    </section>
</div>
{% endblock %}

