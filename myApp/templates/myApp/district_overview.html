{% extends 'myApp/base.html' %}

{% block title %}District {{ district.number }} Overview{% endblock %}

{% block content %}
<div class="space-y-8">
    <header class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        <div>
            <p class="text-sm uppercase tracking-widest text-muted mb-1">District {{ district.number }}</p>
            <h1 class="text-3xl font-heading font-bold text-text-strong mb-3">{{ district.name }}</h1>
            {% if district.description %}
            <p class="text-muted max-w-2xl">{{ district.description }}</p>
            {% endif %}
        </div>
        <div class="flex gap-3">
            <a href="{% url 'district_venues' district.number %}"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/10 transition {% if not base_access %}opacity-50 pointer-events-none{% endif %}">
                <span>üó∫Ô∏è</span>
                <span>Venues</span>
            </a>
            <a href="{% url 'home' %}"
               class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/10 transition">
                <span>üèôÔ∏è</span>
                <span>Back to Districts</span>
            </a>
        </div>
    </header>

    <section class="grid gap-6 lg:grid-cols-2">
        <div class="border border-white/10 rounded-2xl overflow-hidden bg-white/5">
            <div class="aspect-video bg-black/40 flex items-center justify-center">
                {% if district.overview_video_url %}
                    <video controls class="w-full h-full object-cover">
                        <source src="{{ district.overview_video_url }}">
                        Your browser does not support the video tag.
                    </video>
                {% else %}
                    <div class="p-6 text-center text-muted">
                        <p class="text-sm">Overview video coming soon.</p>
                    </div>
                {% endif %}
            </div>
            {% if district.overview_duration %}
            <p class="text-xs text-muted px-4 py-3 border-t border-white/5">Duration: {{ district.overview_duration }} seconds</p>
            {% endif %}
        </div>
        <div class="border border-white/10 rounded-2xl p-6 bg-white/5 flex flex-col">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-lg font-semibold text-text-strong flex items-center gap-2">
                    <span>üìù</span>
                    <span>Transcript</span>
                </h2>
                {% if not district.overview_transcript %}
                <span class="text-xs text-muted">Pending</span>
                {% endif %}
            </div>
            {% if district.overview_transcript %}
            <div class="flex-1 overflow-y-auto pr-2 space-y-4 text-sm text-gray-200 leading-relaxed max-h-[420px]">
                {% for paragraph in district.overview_transcript.splitlines %}
                    {% if paragraph %}
                    <p>{{ paragraph }}</p>
                    {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-muted">Transcript processing‚Äîcheck back soon.</p>
            {% endif %}
        </div>
    </section>

    <section>
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-text-strong">Modules</h2>
            {% if not base_access %}
            <span class="text-xs uppercase tracking-widest text-muted">Preview only ¬∑ complete prerequisites to unlock</span>
            {% endif %}
        </div>
        <div class="grid gap-4 md:grid-cols-2">
            {% for module in module_cards %}
            <article class="border border-white/10 rounded-2xl p-6 bg-white/5">
                <div class="flex items-start justify-between gap-4">
                    <div>
                        <p class="text-sm uppercase tracking-widest text-muted mb-1">Module {{ module.code }}</p>
                        <h3 class="text-lg font-heading font-semibold text-text-strong mb-2">{{ module.name }}</h3>
                        {% if module.description %}
                        <p class="text-sm text-gray-400">{{ module.description }}</p>
                        {% endif %}
                    </div>
                    <span class="px-3 py-1 text-xs font-semibold rounded-full
                        {% if module.status == 'complete' %}bg-emerald-500/20 text-emerald-300
                        {% elif module.status == 'in_progress' %}bg-electric-violet/20 text-electric-violet
                        {% elif module.status == 'available' %}bg-cyan/20 text-cyan
                        {% else %}bg-white/10 text-muted{% endif %}">
                        {{ module.status|title }}
                    </span>
                </div>
                {% if module.unlock_hint %}
                <p class="text-xs text-muted mt-2">Completing this module unlocks {{ module.unlock_hint }}.</p>
                {% endif %}

                <div class="mt-6 flex flex-wrap gap-3">
                    <a href="{% url 'module_learn' module.code %}"
                       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-electric-violet text-white font-semibold shadow-lg shadow-electric-violet/40 hover:bg-violet-600 transition
                              {% if module.status == 'locked' or not base_access %}opacity-50 pointer-events-none{% endif %}">
                        Watch Lesson
                    </a>
                    <a href="{% url 'module_exercises' module.code %}"
                       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/10 transition
                              {% if module.status not in ('in_progress', 'complete') %}opacity-50 pointer-events-none{% endif %}">
                        Go to Exercises
                    </a>
                </div>
            </article>
            {% empty %}
            <div class="border border-dashed border-white/20 rounded-2xl p-8 text-center text-muted">
                No modules configured for this district yet.
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}

