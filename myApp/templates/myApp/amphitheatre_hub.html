{% extends 'myApp/base.html' %}
{% load humanize %}

{% block title %}Greek Amphitheatre ¬∑ Hub{% endblock %}

{% block header_title %}
<div class="hidden md:flex items-center gap-2 text-sm font-semibold text-muted">
    <a href="{% url 'district_venues' user.profile.current_level %}" class="focus-ring">Venues</a>
    <i class="fa-solid fa-angles-right text-[10px]"></i>
    <span>Greek Amphitheatre</span>
</div>
{% endblock %}

{% block content %}
<div class="space-y-8">
    <section class="bg-ink-surface border border-default rounded-3xl shadow-soft overflow-hidden">
        <div class="grid gap-6 md:grid-cols-[1.05fr_0.95fr]">
            <div class="p-6 sm:p-8 lg:p-10 space-y-6">
                <div class="flex items-start justify-between gap-6">
                    <div>
                        <p class="text-xs font-semibold uppercase tracking-[0.28em] text-muted">Venue Hub</p>
                        <h1 class="text-[30px] sm:text-[34px] font-heading font-bold text-text-strong tracking-tight mt-2">
                            Greek Amphitheatre
                        </h1>
                        <p class="text-sm text-text-secondary mt-3 leading-relaxed">
                            A contemplative practice space guided by the Philosopher. Every visit offers a calm loop of exercises
                            to deepen your presence without judgement.
                        </p>
                    </div>
                    <div class="hidden md:block">
                        <div class="w-16 h-16 rounded-2xl bg-electric-violet/10 border border-electric-violet/30 grid place-items-center relative">
                            <span class="text-2xl">üß†</span>
                            <span class="absolute bottom-1 right-1 w-8 h-8 rounded-full bg-white shadow-soft border border-default grid place-items-center text-[11px] font-semibold text-electric-violet">Œ¶</span>
                        </div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-3">
                    <div class="stat-chip">
                        <i class="fa-solid fa-compass"></i>
                        <span>{{ hub.visits }} visit{{ hub.visits|pluralize }}</span>
                    </div>
                    <div class="stat-chip">
                        <i class="fa-solid fa-fire"></i>
                        <span>{{ hub.streak }} day streak</span>
                    </div>
                    <div class="stat-chip">
                        <i class="fa-solid fa-bolt"></i>
                        <span>{{ hub.total_points }} practice points</span>
                    </div>
                    <div class="stat-chip">
                        <i class="fa-solid fa-clock"></i>
                        {% if hub.last_practice %}
                            <span>Last practised {{ hub.last_practice|timesince }} ago</span>
                        {% else %}
                            <span>Your first session awaits</span>
                        {% endif %}
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-3 sm:items-center">
                    <a href="{% url 'amphitheatre_session' %}"
                       class="inline-flex items-center justify-center gap-2 px-5 py-3 rounded-[14px] bg-gradient-to-r from-electric-violet to-purple-600 text-white font-semibold text-sm shadow-electric-violet/50 hover:shadow-electric-violet/60 transition focus-ring animate-press">
                        <span>{% if hub.has_active_session %}Resume Session{% else %}Start Session{% endif %}</span>
                        <i class="fa-solid fa-arrow-right-long text-sm"></i>
                    </a>
                    <a href="{% url 'amphitheatre_settings' %}" class="inline-flex items-center justify-center gap-2 px-4 py-3 rounded-[12px] border border-default text-sm font-semibold text-text-secondary hover:text-electric-violet transition focus-ring">
                        <i class="fa-solid fa-sliders"></i>
                        <span>Settings</span>
                    </a>
                    <div class="flex items-center gap-3 text-xs text-muted">
                        <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
                        <span>Your Philosopher is already breathing with you.</span>
                    </div>
                </div>
            </div>

            <aside class="bg-[rgba(236,239,255,0.65)] border-l border-default/70 p-6 sm:p-8 flex flex-col gap-6">
                <div>
                    <p class="text-xs font-semibold uppercase tracking-[0.26em] text-muted">Next Up</p>
                    <h2 class="text-xl font-heading font-semibold text-text-strong mt-2">{{ hub.hint.label }}</h2>
                    <p class="text-sm text-text-secondary leading-relaxed mt-2">{{ hub.hint.subtext }}</p>
                </div>
                <div class="rounded-2xl border border-default bg-white/80 shadow-soft p-4 space-y-3">
                    <div class="flex items-center justify-between text-xs font-semibold text-muted uppercase tracking-[0.16em]">
                        <span>Session Layout</span>
                        <span>{{ hub.hint.count }} exercise{{ hub.hint.count|pluralize }}</span>
                    </div>
                    <ol class="space-y-2 text-sm text-text-secondary">
                        {% for item in hub.hint.exercise_titles %}
                        <li class="flex items-center gap-3">
                            <span class="w-8 h-8 rounded-full border border-electric-violet/30 bg-electric-violet/10 text-electric-violet font-semibold grid place-items-center text-xs">{{ forloop.counter }}</span>
                            <span>{{ item }}</span>
                        </li>
                        {% empty %}
                        <li class="text-muted text-sm">We‚Äôll pick an exercise mix once you arrive.</li>
                        {% endfor %}
                    </ol>
                </div>
                <div class="p-4 rounded-2xl border border-default bg-white shadow-soft space-y-2">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-electric-violet/10 border border-electric-violet/30 grid place-items-center text-lg">Œ¶</div>
                        <div>
                            <p class="text-sm font-semibold text-text-strong">Philosopher‚Äôs reminder</p>
                            <p class="text-xs text-muted leading-relaxed">‚ÄúNo one grades you here. You‚Äôre rehearsing how gently you can hold yourself.‚Äù</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </section>

    <section class="space-y-4">
        <div class="flex items-center justify-between">
            <h2 class="text-xl font-heading font-semibold text-text-strong">Recent Reflections</h2>
            <div class="flex items-center gap-3 text-xs text-muted">
                <i class="fa-solid fa-record-vinyl"></i>
                <span>Audio clips replay quietly in history.</span>
            </div>
        </div>
        <div class="grid gap-4 md:grid-cols-2">
            {% for reflection in recent_reflections %}
            <article class="bg-ink-surface border border-default rounded-2xl shadow-soft p-5 space-y-3">
                <div class="flex items-center justify-between gap-3">
                    <div>
                        <p class="text-xs uppercase tracking-[0.2em] text-muted">Visit {{ reflection.session_visit }}</p>
                        <h3 class="text-base font-heading font-semibold text-text-strong">{{ reflection.exercise_title }}</h3>
                    </div>
                    {% if reflection.has_audio %}
                    <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full border border-electric-violet/30 bg-electric-violet/10 text-electric-violet text-[11px] font-semibold">
                        <i class="fa-solid fa-microphone-lines"></i>
                        <span>Audio</span>
                    </span>
                    {% endif %}
                </div>
                {% if reflection.reflection_text %}
                <p class="text-sm text-text-secondary leading-relaxed">‚Äú{{ reflection.reflection_text }}‚Äù</p>
                {% endif %}
                {% if reflection.philosopher_response %}
                <div class="bg-electric-violet/5 border border-electric-violet/20 rounded-xl p-3 text-xs text-electric-violet leading-relaxed">
                    {{ reflection.philosopher_response }}
                </div>
                {% endif %}
                <div class="text-xs text-muted">
                    {% if reflection.timestamp %}
                        {{ reflection.timestamp|naturaltime }}
                    {% else %}
                        Moments ago
                    {% endif %}
                </div>
            </article>
            {% empty %}
            <div class="md:col-span-2 bg-ink-surface border border-dashed border-default rounded-2xl p-8 text-center text-muted">
                Your reflections will live here once you complete a session.
            </div>
            {% endfor %}
        </div>
    </section>

    <section class="bg-ink-surface border border-default rounded-3xl shadow-soft p-6 sm:p-8 space-y-4">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-electric-violet/10 border border-electric-violet/30 grid place-items-center text-electric-violet">
                <i class="fa-solid fa-heart-pulse"></i>
            </div>
            <div>
                <h2 class="text-lg font-heading font-semibold text-text-strong">Session Ritual</h2>
                <p class="text-sm text-text-secondary">Each loop is under 45 seconds. Finish early? The Philosopher will offer a gentle score and send you on.</p>
            </div>
        </div>
        <dl class="grid gap-4 sm:grid-cols-3 text-sm text-text-secondary">
            <div class="space-y-1">
                <dt class="font-semibold text-text-strong">Breath arrives first</dt>
                <dd>Step in with a grounding inhale. The Recorder waits for you.</dd>
            </div>
            <div class="space-y-1">
                <dt class="font-semibold text-text-strong">Reflections, not grades</dt>
                <dd>Points only track completion and optional reflection‚Äîno correctness scoring.</dd>
            </div>
            <div class="space-y-1">
                <dt class="font-semibold text-text-strong">Progress carries forward</dt>
                <dd>Network hiccup? We‚Äôll store locally and sync once the winds return.</dd>
            </div>
        </dl>
    </section>
</div>

{{ next_plan|json_script:"amphitheatre-next-plan" }}
{% endblock %}

